<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <QuestScriptDef>
    <defName>OpportunitySite_AlphaThrumbo_Giver</defName>
    <isRootSpecial>true</isRootSpecial>
    <randomlySelectable>false</randomlySelectable>
    <givenBy>
      <li>Traders</li>
      <li>Beggars</li>
      <li>Reading</li>
    </givenBy>
    <rootSelectionWeight>0.15</rootSelectionWeight>
    <rootMinPoints>0</rootMinPoints>
    <rootEarliestDay>45</rootEarliestDay>
    <autoAccept>true</autoAccept>
    <minRefireDays>300</minRefireDays>
    <questNameRules>
      <rulesStrings>
        <li>questName->alpha thrumbo</li> 
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[discoveryMethod] the location of an alpha thrumbo.\n\nAlpha thrumbos are exceptionally rare creatures, believed by many to be mere fiction. Too wild for most to tame and too powerful for most to hunt, their horns are worth more than their weight in gold.</li>
      </rulesStrings>
    </questDescriptionRules>
    <questSubjectRules>
      <rulesStrings>
        <li>subject->alpha thrumbos</li>
        <li>subject->thrumbos</li>
        <li>subject->rare thrumbos</li>
        <li>subject->rare animals</li>
        <li>subject->legendary creatures</li>

        <li>questMapFeature->drawing of a thrumbo</li>
        <li>questMapFeature->sketch of an odd-looking thrumbo</li>

        <li>questMapText->thrumbo habitat</li>
        <li>questMapText->alpha thrumbo</li>
        <li>questMapText->found the beast</li>
        <li>questMapText->they are real</li>
      </rulesStrings>
    </questSubjectRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_Set">
          <name>siteDistRange</name>
          <value>40~120</value>
        </li>
        
        <li Class="QuestNode_GetMap">
          <canBeSpace>true</canBeSpace>
        </li>

        <li Class="QuestNode_IsSet">
          <name>discoveryMethod</name>
          <elseNode Class="QuestNode_RandomNode">
            <nodes>
              <li Class="QuestNode_Set">
                <name>discoveryMethod</name>
                <value>You have discovered</value>
              </li>
            </nodes>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
          <selectLandmarkChance>1</selectLandmarkChance>
          <allowedLandmarks>
            <li>Oasis</li>
            <li>Lake</li>
            <li>LakeWithIsland</li>
            <li>LakeWithIslands</li>
            <li>Pond</li>
            <li>DryLake</li>
            <li>ToxicLake</li>
            <li>Wetland</li>
            <li>HotSprings</li>
            <li>Archipelago</li>
            <li>CoastalIsland</li>
            <li>Peninsula</li>
            <li>Bay</li>
            <li>Fjord</li>
            <li>CoastalAtoll</li>
            <li>Iceberg</li>
            <li>Valley</li>
            <li>Cavern</li>
            <li>Chasm</li>
            <li>Crevasse</li>
            <li>Plateau</li>
            <li>IceDunes</li>
            <li>Cliffs</li>
            <li>Hollow</li>
            <li>Basin</li>
            <li>TerraformingScar</li>
            <li>LavaLake</li>
            <li>LavaCrater</li>
            <li>LavaFlow</li>
            <li>Dunes</li>
            <li>Ruins</li>
            <li>FrozenRuins</li>
            <li>AncientSmokeVent</li>
            <li>AncientHeatVent</li>
            <li>AncientQuarry</li>
            <li>AbandonedColonyTribal</li>
            <li>AbandonedColonyOutlander</li>
            <li>AncientLaunchSite</li>
            <li>Harbor</li>
            <li>AncientGarrison</li>
            <li>AncientWarehouse</li>
            <li>AncientChemfuelRefinery</li>
          </allowedLandmarks>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AlphaThrumboSighting</tag>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
          <parms>
            <hiddenSitePartsPossible>false</hiddenSitePartsPossible>
            <worldObjectDef>ClaimableSite</worldObjectDef>
          </parms>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(25,35)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">Intercepted communications indicate the alpha thrumbo has moved on. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
</Defs>