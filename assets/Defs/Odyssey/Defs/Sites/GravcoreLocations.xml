<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <SitePartDef Name="SpaceSiteBase" Abstract="True">
    <gravShipsCanLandOn>true</gravShipsCanLandOn>
    <wantsThreatPoints>true</wantsThreatPoints>
    <disallowsAutomaticDetectionTimerStart>true</disallowsAutomaticDetectionTimerStart>
    <minMapSize>(200, 0, 200)</minMapSize>
  </SitePartDef>
  
  <SitePartDef Name="GravcoreLocationBase" Abstract="True">
    <mainPartAllThreatsLabel>Contains: Gravcore</mainPartAllThreatsLabel>
    <siteTexture>World/WorldObjects/Sites/GravcoreLocation</siteTexture>
    <expandingIconTexture>World/WorldObjects/Expanding/Gravcore</expandingIconTexture>
    <gravShipsCanLandOn>true</gravShipsCanLandOn>
    <wantsThreatPoints>true</wantsThreatPoints>
    <disallowsAutomaticDetectionTimerStart>true</disallowsAutomaticDetectionTimerStart>
    <leaveAbandonedSettlement>true</leaveAbandonedSettlement>
    <minMapSize>(200, 0, 200)</minMapSize>
    <considerEnteringAsAttack>false</considerEnteringAsAttack>
  </SitePartDef>

  <SitePartDef Name="SpaceGravcoreLocationBase" ParentName="GravcoreLocationBase" Abstract="True">
    <leaveAbandonedSettlement>false</leaveAbandonedSettlement>
  </SitePartDef>
  
  <!-- Abandoned settlement -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>AbandonedSettlement</defName>
    <label>abandoned settlement</label>
    <description>The gravcore energy signature is coming from somewhere in this settlement. Explore the abandoned buildings to find the gravcore.</description>
    <workerClass>SitePartWorker_AbandonedSettlement</workerClass>
    <tags>
      <li>AbandonedSettlement</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>AbandonedSettlement</defName>
    <linkWithSite>AbandonedSettlement</linkWithSite>
    <order>400</order>
    <genStep Class="GenStep_Settlement">
      <count>1</count>
      <requiredGravcoreRooms>1</requiredGravcoreRooms>
      <nearMapCenter>true</nearMapCenter>
      <generatePawns>false</generatePawns>
    </genStep>
  </GenStepDef>

  <RuleDef>
    <defName>Gravcore</defName>
    <symbol>gravcore</symbol>
    <resolvers>
      <li Class="SymbolResolver_GenericRoom">
        <minRectSize>(4, 4)</minRectSize>
        <interior>interior_gravcore</interior>
      </li>
    </resolvers>
  </RuleDef>

  <RuleDef>
    <defName>Interior_Gravcore</defName>
    <symbol>interior_gravcore</symbol>
    <resolvers>
      <li Class="SymbolResolver_Interior_Gravcore">
        <minRectSize>(3, 3)</minRectSize>
      </li>
    </resolvers>
  </RuleDef>
  
  <!-- Mechanoid relay -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>MechanoidRelay</defName>
    <label>mechanoid relay</label>
    <description>The gravcore energy signature is coming from a mechanoid communication relay here. Disassemble it to acquire the gravcore.</description>
    <workerClass>SitePartWorker_MechanoidRelay</workerClass>
    <tags>
      <li>MechanoidRelay</li>
    </tags>
  </SitePartDef>
  
  <GenStepDef>
    <defName>MechanoidRelay</defName>
    <linkWithSite>MechanoidRelay</linkWithSite>
    <order>1600</order>
    <genStep Class="GenStep_MechanoidRelay" />
  </GenStepDef>
  
  <!-- Insect Lair -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>InsectLair</defName>
    <label>cave system</label>
    <description>You have detected the energy signature of a gravcore emanating from a cave system deep underground. The entrance to the cave system is marked on the world map.\n\nObtain gravcores and gravlite paneling to upgrade your gravship.</description>
    <workerClass>SitePartWorker_InsectLair</workerClass>
    <tags>
      <li>InsectLair</li>
    </tags>
    <forceMutators>
      <li>Cavern</li>
    </forceMutators>
  </SitePartDef>
  
  <GenStepDef>
    <defName>InsectLair</defName>
    <linkWithSite>InsectLair</linkWithSite>
    <order>1600</order>
    <genStep Class="GenStep_InsectLairSite" />
  </GenStepDef>

  <!-- Ancient Reactor -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>AncientReactor</defName>
    <label>ancient reactor</label>
    <description>An ancient reactor is hidden within nearby ruins. The reactor is cracked and leaking toxic fallout over the whole region. Locate and disable the reactor to obtain a gravcore and stop the fallout.</description>
    <tags>
      <li>AncientReactor</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>AncientReactor</defName>
    <linkWithSite>AncientReactor</linkWithSite>
    <order>740</order>
    <genStep Class="GenStep_AncientReactor" />
    <preventsGenSteps> <!-- incompatible with these, they would just conflict -->
      <li>AncientRuins_Scarlands</li>
      <li>FrozenRuins</li>
    </preventsGenSteps>
  </GenStepDef>

  <!-- Orbital Mechanoid Platform -->

  <SitePartDef ParentName="SpaceGravcoreLocationBase">
    <defName>OrbitalMechanoidPlatform</defName>
    <label>mechanoid platform</label>
    <description>You have detected the energy signature of a gravcore on this platform. There is a heavy mechanoid presence.\n\nBe careful, orbital locations are extremely dangerous. Ensure your gravship is fully enclosed with airtight walls and equip your colonists with vacsuits. Plan your return trip, as living in orbit for long periods is very difficult.</description>
    <tags>
      <li>OrbitalMechanoidPlatform</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>OrbitalMechanoidPlatform</defName>
    <linkWithSite>OrbitalMechanoidPlatform</linkWithSite>
    <order>200</order>
    <genStep Class="GenStep_OrbitalPlatform">
      <platformTerrain>MechanoidPlatform</platformTerrain>
      <factionDef>Mechanoid</factionDef>
      <layoutDef>OrbitalMechanoidPlatform</layoutDef>
      <orbitalDebrisDef>Mechanoid</orbitalDebrisDef>
      <fogOfWarColor>(52,55,45)</fogOfWarColor>
    </genStep>
  </GenStepDef>

  <!-- Ancient Stockpile -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>AncientStockpile</defName>
    <label>ancient stockpile</label>
    <description>You have detected the energy signature of a gravcore emanating from an ancient underground stockpile. The location is marked on the world map.\n\nObtain gravcores and gravlite panels to increase the size of your gravship.</description>
    <tags>
      <li>AncientStockpile</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>AncientStockpile_Gravcore</defName>
    <linkWithSite>AncientStockpile</linkWithSite>
    <order>1600</order>
    <genStep Class="GenStep_AncientStockpile_Gravcore" />
  </GenStepDef>

  <!-- Crashed Mechanoid Platform -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>CrashedMechanoidPlatform</defName>
    <label>crashed mechanoid platform</label>
    <description>The remains of an orbital platform are strewn nearby. Be careful, the wreckage contains hostile mechanoids.\n\nThe gravcore signal is coming from somewhere within the crash site.</description>
    <tags>
      <li>AncientReactor</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>CrashedMechanoidPlatform</defName>
    <linkWithSite>CrashedMechanoidPlatform</linkWithSite>
    <order>400</order>
    <genStep Class="GenStep_CrashedMechanoidPlatform" />
    <preventsGenSteps> <!-- incompatible with these, they would just conflict -->
      <li>AncientRuins_Scarlands</li>
      <li>FrozenRuins</li>
    </preventsGenSteps>
  </GenStepDef>

  <!-- Orbital Ancient Platform -->

  <SitePartDef ParentName="SpaceGravcoreLocationBase">
    <defName>OrbitalAncientPlatform</defName>
    <label>abandoned orbital platform</label>
    <description>You have detected the energy signature of a gravcore.\n\nBe careful - orbital locations are extremely dangerous. Ensure your gravship is fully enclosed with airtight walls and equip your colonists with vacsuits. Plan your return trip, as living in orbit for long periods is very difficult.</description>
    <tags>
      <li>OrbitalAncientPlatform</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>OrbitalAncientPlatform</defName>
    <linkWithSite>OrbitalAncientPlatform</linkWithSite>
    <order>200</order>
    <genStep Class="GenStep_OrbitalPlatform">
      <factionDef>AncientsHostile</factionDef>
      <platformTerrain>OrbitalPlatform</platformTerrain>
      <layoutDef>OrbitalAncientPlatform</layoutDef>
      <orbitalDebrisDef>Manmade</orbitalDebrisDef>
      <temperature>20</temperature>
      <spawnSentryDrones>true</spawnSentryDrones>
      <exteriorPrefabs>
        <CrashedShuttle>0~1</CrashedShuttle>
        <BaricadeTurret>2~5</BaricadeTurret>
      </exteriorPrefabs>
    </genStep>
  </GenStepDef>

  <!-- Frozen Terraformer -->

  <SitePartDef ParentName="GravcoreLocationBase">
    <defName>FrozenTerraformer</defName>
    <label>frozen terraformer</label>
    <description>You have detected the energy signature of a gravcore. The gravcore is powering a malfunctioning ancient terraformer. Its location is marked on the world map.\n\nThe terraformer is cooling the local region to dangerously low temperatures. Be prepared for cold weather.\n\nObtain gravcores and gravlite panels to increase the size of your gravship.</description>
    <tags>
      <li>FrozenTerraformer</li>
    </tags>
  </SitePartDef>

  <GenStepDef>
    <defName>FrozenTerraformer</defName>
    <linkWithSite>FrozenTerraformer</linkWithSite>
    <order>399</order> <!-- before gravship -->
    <genStep Class="GenStep_FrozenTerraformer" />
  </GenStepDef>

  <!-- Orbital Mechhive -->

  <SitePartDef ParentName="SpaceGravcoreLocationBase">
    <defName>OrbitalMechhive</defName>
    <label>mechhive</label>
    <description>You have detected the mechhive in orbit above the planet. Its location is marked on the world map.\n\nThe mechhive is the center of mechanoid intelligence and directs mechanoids across planet. If shut down, it will disable mechanoids planet-wide. Alternatively, you may be able to use the mechhive for your own purposes.\n\nBe warned, mechhives are extremely dangerous. Finish exploring other locations first and ensure you're prepared for a long stay in orbit.</description>
    <expandingIconTexture>World/WorldObjects/Expanding/MechhivePlatform</expandingIconTexture>
    <tags>
      <li>OrbitalMechhive</li>
    </tags>
    <minMapSize>(250, 1, 250)</minMapSize>
    <displayOnInspectPane>false</displayOnInspectPane>
    <mainPartAllThreatsLabel />
  </SitePartDef>
  
</Defs>