<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <QuestScriptDef>
    <defName>OrbitalFugitive</defName>
    <rootSelectionWeight>1</rootSelectionWeight>
    <expireDaysRange>4~8</expireDaysRange>
    <minRefireDays>30</minRefireDays>
    <canOccurOnAllPlanetLayers>true</canOccurOnAllPlanetLayers>
    <everAcceptableInSpace>true</everAcceptableInSpace>
    <questNameRules>
      <rulesStrings>
        <li>questName->The Hunt for [fugitive_nameDef]</li>
        <li>questName->A Bounty for [fugitive_nameDef]</li>
        <li>questName->[fugitive_nameDef] the [criminal]</li>
        <li>questName->The Orbital [criminal]</li>

        <li>criminal->Criminal</li>
        <li>criminal->Fugitive</li>
        <li>criminal->Outlaw</li>
        <li>criminal->Felon</li>
        <li>criminal->Renegade</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <!-- Asker is null -->
        <li>questDescription(askerIsNull==true)->An anonymous AI has requested your help dealing with an outlaw named [fugitive_nameDef]. The AI claims [fugitive_nameDef] is wanted for [reason_AI].\n\n[fugitive_nameDef] has stolen a transport pod and has fled to an abandoned orbital platform.\n\nHaving heard rumors of your gravship, the AI requests that you travel to the abandoned platform and kill [fugitive_nameDef]. In return, it will reward you with a gravtech device.\n\nThe AI warns you that [fugitive_nameDef] may be in the company of hostile orbital pirates.</li>

        <!-- Leader asker -->
        <li>questDescription(asker_factionLeader==true)->[asker_faction_leaderTitle] [asker_nameFull] of [asker_faction_name] has sent us a message. A fugitive named [fugitive_nameDef] escaped from [asker_possessive] custody and used a transport pod to flee to an abandoned orbital platform. [fugitive_nameDef] was in custody for [reason].\n\nHaving heard rumors of your gravship, the [asker_faction_leaderTitle] asks that you travel to the abandoned platform and kill [fugitive_nameDef]. If you do so, [asker_nameDef] will reward you with a gravtech device.\n\n[asker_nameDef] warns you that [fugitive_nameDef] may be in the company of hostile orbital pirates.</li>

        <!-- Royal asker -->
        <li>questDescription(asker_royalInCurrentFaction==true)->[asker_nameFull], a [asker_royalTitleInCurrentFaction] of [asker_faction_name], requests that you track down and kill a dangerous fugitive known as [fugitive_nameDef]. The fugitive is wanted for [reason_royal].\n\n[fugitive_nameDef] is hiding out on an abandoned orbital platform and may be guarded by orbital pirates. If you kill the fugitive, [asker_nameDef] will reward you with a gravtech device.</li>

        <li>reason_AI->the destruction of multiple high-level subpersona cores</li>
        <li>reason_AI->deorbiting an AI satellite</li>
        <li>reason_AI->crimes on numerous distant planets</li>
        <li>reason_AI->unlicensed orbital trafficking of psychic artifacts</li>
        <li>reason_AI->[reason]</li>

        <li>reason_royal->drunkenly insulting the [asker_royalTitleInCurrentFaction] in a wedding speech</li>
        <li>reason_royal->attempting to assassinate the [asker_royalTitleInCurrentFaction]</li>
        <li>reason_royal->accidentally detonating a firefoam pack in an imperial shuttle</li>
        <li>reason_royal->the improper use of a tornado generator near an imperial settlement</li>
        <li>reason_royal->trying to orchestrate a rebellion</li>
        <li>reason_royal->treason</li>
        <li>reason_royal->[reason]</li>

        <li>reason->collaborating with a sanguophage cabal</li>
        <li>reason->trafficking dangerous psychic artifacts</li>
        <li>reason->grand larceny and multiple counts of corporate sabotage</li>
        <li>reason->unauthorized genetic experimentation</li>
        <li>reason->inciting inter-factional conflict</li>
        <li>reason->drunkenly profaning a peace ritual</li>
        <li>reason->the destruction of an orbital trade vessel</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_RequirementsToAcceptResearch">
          <reserach>BasicGravtech</reserach>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetMap">
          <canBeSpace>true</canBeSpace>
        </li>

        <li Class="QuestNode_IsSet">
          <name>asker</name>
          <elseNode Class="QuestNode_GetPawn">
            <storeAs>asker</storeAs>
            <mustBeFactionLeader>true</mustBeFactionLeader>
            <mustBeNonHostileToPlayer>true</mustBeNonHostileToPlayer>
            <hostileWeight>0</hostileWeight>
            <selectionWeight>1.0</selectionWeight>
            <minTechLevel>Industrial</minTechLevel>
          </elseNode>
        </li>

        <li Class="QuestNode_Root_Site">
          <layerWhitelist>
            <li>Orbit</li>
          </layerWhitelist>
          <canBeSpace>true</canBeSpace>
          <sitePartDef>OrbitalFugitivePlatform</sitePartDef>
          <worldObjectDef>ClaimableSpaceSite</worldObjectDef>
          <distanceFromColonyRange>2~8</distanceFromColonyRange> <!-- distance is in on the orbital layer tiles -->
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(45,60)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_End">
            <outcome>Fail</outcome>
            <sendStandardLetter>true</sendStandardLetter>
          </node>
        </li>

        <li Class="QuestNode_Root_OrbitalFugitive" />

        <li Class="QuestNode_GenerateThingSet">
          <thingSetMaker>Reward_GravshipUpgrade</thingSetMaker>
          <storeAs>upgradeItem</storeAs>
        </li>

        <!-- Send rewards and end after survey has been completed -->
        <li Class="QuestNode_AllSignals">
          <inSignals>
            <li>fugitive.Destroyed</li>
          </inSignals>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_AddItemsReward">
                <items>$upgradeItem</items>
              </li>
              <li Class="QuestNode_End">
                <outcome>Success</outcome>
                <sendStandardLetter>true</sendStandardLetter>
              </li>
            </nodes>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <SitePartDef ParentName="SpaceSiteBase">
    <defName>OrbitalFugitivePlatform</defName>
    <expandingIconTexture>World/WorldObjects/Expanding/AbandonedPlatform</expandingIconTexture>
    <tags>
      <li>OrbitalFugitivePlatform</li>
    </tags>
    <minMapSize>(200, 0, 200)</minMapSize>
    <copyQuestName>true</copyQuestName>
  </SitePartDef>

  <GenStepDef>
    <defName>OrbitalFugitivePlatform</defName>
    <linkWithSite>OrbitalFugitivePlatform</linkWithSite>
    <order>200</order>
    <genStep Class="GenStep_OrbitalPlatform">
      <factionDef>Salvagers</factionDef>
      <platformTerrain>OrbitalPlatform</platformTerrain>
      <layoutDef>Opportunity_AbandonedPlatform_Enterable</layoutDef>
      <orbitalDebrisDef>Manmade</orbitalDebrisDef>
      <temperature>20</temperature>
      <spawnSentryDrones>false</spawnSentryDrones>
    </genStep>
  </GenStepDef>

</Defs>